		Raspberry Pi i2c HOWTO
	Alexander Smirnov <alllecs@yandex.ru>
			13/05/2015

1. Об этом руководстве

Это руководство описывает подключение 
часов реального времени (ЧРВ)
Tiny RTC на базе микросхемы 13072
к Raspberry Pi(rpi) по i2c.

2. Настройка i2c на rpi

Для настройки i2c необходимо зайти
под суперпользователем,
для этого напишите в терминале

    sudo bash

Установите специальные утилиты
для работы с i2c из командной строки.
Для этого напишите в терминале

    apt-get update
    apt-get install i2c-tool

Для включение аппаратного интерфейса i2c
необходимо перейти в файл
/etc/modprobe.d/raspi-blacklist.conf
и закомментировать строку:

    blacklist i2c-bcm2708

Для загрузки модуля при включении rpi
перейдите в файл /etc/modules
Необходимо добавить строки, если их там нет:

    i2c-dev
    i2c-bcm2708

после чего перезагрузить rpi.

Для проверки, что модули загруженны
выполните в терминале:

    lsmod  | grep i2c

3. Проверка подключения ЧРВ
Подключите Tiny RTC DS1307 к rpi.
Для проверки правильности подключения
выполните команду:

    i2cdetect -y 1

если видите 50 и 68,
ЧРВ подключен правильно.
Если нет, еще раз внимательно проверьте подключение.

Для получения данных,
необходимо выполнить команду:

    i2cget -y 1 0x68 0

Задаем драйверу ds1307 часы по адресу 0x68.
Для этого выполните команду:

    echo ds1307 0x68 > /sys/class/i2c-adapter/i2c-1/new_device

Для вывода показаний ЧРВ
напишите в терминале:

    hwclock

Если время установлено неправильно,
то установите вручную, выполнив:

	date --set="2014-11-23 18:35:47"

Обновите hwclock, для этого выполните:

	/sbin/hwclock --hctosys

Для синхронизации времени добавьте в /etc/rc.local
строку перед 'exit 0':

	echo ds1307 0x68 > /sys/class/i2c-adapter/i2c-1/new_device 

